# Materials and Methods

## Study areas

We defined 119 study areas representing 92 countries (Table \@ref(tab:samp-size)) and covering the integrality of the moist tropical forest in the world, at the exception of some islands (eg. Sao Tome and Principe or Wallis-and-Futuna). Each country was identified by one unique three-letter code following the ISO 3166-1 standard (eg. MDG for Madagascar or GUF for French Guyana). Most of the countries corresponded to one unique study area, with three exceptions: Brazil, India, and Australia. Brazil, because of its large size, was divided into 26 study areas corresponding to the 26 administrative states (the state of Goias including the Federal District). For India, which is also a large country, the tropical moist forest is located in three distinct regions far from each other. We thus considered three independent study areas for India: the Western Ghats, North-East India (including the West Bengale), and the union territory of the Andaman and Nicobar Islands. For Australia, we only considered the Queensland state as a study area. Data sampling and spatial deforestation modelling were performed independently for each study area. Study area borders were obtained from version 3.6 of the Global Administrative Areas database (<https://gadm.org>). We used level-0 data for study areas corresponding to countries and level-1 data for study areas corresponding to states or regions. We grouped the study areas in three continents (Fig. \@ref(fig:study-areas)): America (64 study areas for 39 countries), Africa (32 study areas for 32 countries), and Asia (23 study areas for 21 countries).

## Historical forest cover change maps

For each study area, we derived historical forest cover change maps on two periods of time: 1$^{\text{st}}$ January 2000 -- 1$^{\text{st}}$ January 2010, and 1$^{\text{st}}$ January 2010 -- 1$^{\text{st}}$ January 2020 from the forest cover change annual product by @Vancutsem2020. @Vancutsem2020 annual product classifies Landsat image pixels at 30 m resolution in 16 categories for each year (on the 31$^{\text{st}}$ of December) between 1982 and 2019 and allows identifying moist tropical forest pixels at each date (Table \@ref(tab:cat-annual-product)). This classification is based on an expert model analyzing time-series data at the pixel level extracted from the full Landsat satellite image archive on the period 1982--2019. The expert model has been built on Google Earth Engine [@Gorelick2017]. For our forest definition, we only considered natural old-growth moist tropical forest, disregarding plantations and regrowths. We included degraded forests (not yet deforested) in our forest definition. As a consequence, we considered pixels in the following categories: 1, 2, 3, 4, 5, 13, or 14 in the annual product, to be natural old-growth moist tropical forest pixels (simply abbreviated "forest" in this manuscript). Because several decades are usually necessary to reach the state of old-growth forest, we assumed every pixels classified as "forest" at a given date between 1999 and 2019 to be also classified as "forest" in the previous years of that period of time. We thus obtained three forest cover maps for the dates 1$^{\text{st}}$ January 2000, 1$^{\text{st}}$ January 2010, and 1st January 2020. We combined these three maps to obtained high-resolution moist tropical forest cover change maps on the periods 2000--2010--2020 at 30 m resolution at the global scale.

We did not consider potential forest regrowth in our forest definition for three main reasons. First, throughout the humid tropics, forest regeneration involves much smaller areas than deforestation [@Vancutsem2020, see also 2000-2012 tree cover gain in @Hansen2013]. Second, there is little evidence of natural forest regeneration in the long term in the tropics [@Grouzis2001]. This can be explained by several ecological processes following deforestation such as soil erosion [@Grinand2017] and reduced seed bank due to fire-induced deforestation and soil loss [@Grouzis2001]. Moreover, in areas where forest regeneration is ecologically possible, young forest regrowth are more easily re-burnt for agriculture and pasture [@Vieilledent2020]. Third, young secondary forests generally provide more limited ecosystem services compared to old-growth natural forests in terms of biodiversity [@Gibson2011] and carbon storage [@Blanc2009].

**Add a figure for forest cover and indicate web-site with interactive map.**

## Spatial explanatory variables

To explain the observed deforestation on the period 2010--2020, we considered a set of spatial explanatory variables describing: topography (altitude and slope), accessibility (distances to nearest road, town, and river), forest landscape (distance to forest edge), deforestation history (distance to past deforestation), and land conservation status (belonging to a protected area). This set of variables were selected on an _a priori_ knowledge of the deforestation process [@Gorenflo2011; @Vieilledent2013; @Geist2001]. For example, the risk of deforestation is supposed to decrease with the distance to road and forest edge (lower accessibility), to increase at lower elevation and slope (higher probability to find arable lands), and to decrease in protected areas (higher level of protection). Characteristics of each explanatory variable are summarized in Table \@ref(tab:variables).

Elevation (in m) and slope (in degree) at 90 m resolution were obtained from the SRTM Digital Elevation Database v4.1 (<http://srtm.csi.cgiar.org/>). Distances (in m) to nearest road, town and river at 150 m resolution were obtained from the OpenStreetMap (OSM) project (<https://www.openstreetmap.org/>). OSM country data were downloaded from two web-sites: Geofabric (<http://download.geofabrik.de/>) and OpenStreetMap.fr (<https://download.openstreetmap.fr/extracts/>) depending on the availability of the data for each country. To obtain the road network in each country, we considered the "motorway", "trunk", "primary", "secondary" and "tertiary" categories for the "highway" key in OSM. To obtain the network of populated places in each country (that we simply call "towns" in the present study), we considered the "city", "town" and "village" categories for the "place" key in OSM. To obtain the river network in Madagascar, we considered the "river" and "canal" categories for the "waterway" key in OSM. For a more detailed description of each category, see the OSM wiki page (<https://wiki.openstreetmap.org/wiki/Tags>). OSM data have been downloaded during the period January--March 2020 for all countries. Distance to forest edge was computed at 30 m resolution from the forest cover map in 2010. Distance to past deforestation in 2010 was computed at 30 m resolution from the 2000--2010 forest cover change map. To minimize border effect for the computation of distance to forest edge and distance to past deforestation, a buffer of 10 km around each study area extent was considered. Data on protected areas were obtained from the World Database on Protected Areas (<https://www.protectedplanet.net>, @WDPA2020) using the `pywdpa` Python package (<https://pypi.org/project/pywdpa/>). WDPA data have been downloaded during the period January--March 2020 for all countries. All protected areas defined by at least one polygon were considered in the analysis, but protected areas defined by a point were not taken into account. Data included protected areas of all IUCN categories (from Ia to VI) and of all types defined at the national level (e.g. National Parks, Reserves), even if the type and IUCN category were not reported. Polygons representing protected areas were rasterized at 30 m resolution.

In total, we obtained 8 spatial explanatory variables to model the spatial probability of deforestation Table \@ref(tab:variables).

**Add figures for explanatory variables: global road network, global protected areas.**

## Data sampling for spatial modelling of the deforestation

Through the spatial modelling of the deforestation, our aim is not to estimate the intensity of deforestation (or "quantity" census @Pontius2011) per study area, that could be expressed in %/year or in ha/year for example. With our model, we want to estimate the effects of a set of variables in determining the location of the deforestation (or "allocation" census @Pontius2011) and compute the relative probability of deforestation for each forest pixels. A balanced sample between deforested and non-deforested pixels is preferable in this case [@Dezecache2017; @Vieilledent2013]. Because deforestation events are rare ($\approx$ 1 %/yr), a non-stratified sample would lead to very few observations of deforestation events, rendering difficult a good estimation of the effects of the explanatory variables. Moreover, if the value of the model intercept (estimated average deforestation) would change with a random sampling, this is not the case for other model parameter values (including variable effects) which are not affected by the stratified balanced sampling.

As a consequence, we performed a stratified balanced sampling between (i) forest pixels in 2010 which have been deforested on the period 2010--2020 ("deforested" pixels), and (ii) forest pixels in 2010 which have not been deforested on that period of time and which represent the remaining forest in 2020 ("non-deforested" pixels). To maximize the representativity of the data, the total number of forest pixels sampled in each study area for the year 2010 has been chosen proportional to the area of forest in 2010 in that study area (2000 points for 1 Mha of forest), with the condition that this number had to be between 20,000 (sufficient number of observations to be representative of the deforestation process) and 100,000 (to limit computation time). When, for a specific study area, the total number of pixels in one of the two categories (deforested vs. non-deforested pixels) was $\leq$ 10,000, all the pixels of that category were included in the sample. This could happen for study areas with low moist forest cover such as small islands (eg. Antigua and Barbuda). For each sampled pixel, we retrieved information regarding the 8 computed explanatory variables at their original spatial resolution. When the information was not complete for a given pixel (eg. elevation and slope data missing for a forest pixel located close to the sea border), the observation was removed from the data-set. Missing information affected a minority of pixels. The global data-set included a total of 3,186,698 observations (1,601,810 of non-deforested pixels and 1,584,888 of deforested pixels, corresponding to an area of 144,163 ha and 142,647 ha, respectively).

**Add figure for data sampling (red and green points).**

## Spatial deforestation model

Using observations of the deforestation on the period 2010--2020, we modelled the spatial probability of deforestation as a function of the height explanatory variables using a logistic regression. We considered the random variable $y_i$ which takes value 1 if the forest pixel $i$ was deforested on the period 2010--2020 and 0 if it was not. We assumed that $y_i$ follows a Bernoulli distribution of parameter $\theta_i$. In our model, $\theta_i$ represents the spatial probability of deforestation for pixel $i$. We assumed that $\theta_i$ is linked, through a logit function, to a linear combination of the explanatory variables $X_i \beta$, where $X_i$ is the vector of explanatory variables for pixel $i$ and $\beta$ is the vector of effects of each variable to be estimated. All the continuous explanatory variables were normalized before fitting the model. The model includes an intercept $\alpha$. To account for the residual spatial variation in the deforestation process, we included additional random effects $\rho_j$ for each spatial cell $j$ of a 10 $\times$ 10 km grid covering each study area. This grid resolution was choosen in order to have a reasonable balance between a good representation of the spatial variability of the deforestation process and the number of parameters. We assumed that random effects were spatially autocorrelated through an intrinsic conditional autoregressive (iCAR) model [@Besag1991; @Banerjee2014]. This model is denoted "icar" in subsequent sections and results. In an iCAR model, the random effect $\rho_j$ associated to cell $j$ depends on the values of the random effects $\rho_{j^{\prime}}$ associated to neighbouring cells $j^{\prime}$. In our case, the neighbouring cells are cells connected to the target cell $j$ through a common border or corner (cells defined by the "king move" in chess). The number of neighbouring cells for cell $j$, which might vary, is denoted $n_j$. Additional spatial random effects $\rho_j$ account for unmeasured or unmeasurable variables [@Clark2005] that explain a part of the residual spatial variation in the deforestation process that is not explained by the fixed environmental variables ($X_i$).

\begin{equation}
\begin{split}
  y_i \sim \mathcal{B}ernoulli(\theta_i)\\
  \text{logit}(\theta_i) = \alpha + X_i \beta + \rho_j\\
  \rho_j \sim \mathcal{N}ormal(\sum_{j^{\prime}} \rho_{j^{\prime}} / n_j,V_{\rho} / n_j)
\end{split}
(\#eq:icar)
\end{equation}

## Parameter inference

Parameter inference was done in a hierarchical Bayesian framework. Non-informative priors were used for all parameters: $\alpha \sim \mathcal{N}ormal(\text{mean}=0,\text{var}=10^6)$, $\beta \sim \mathcal{N}ormal(\text{mean}=0,\text{var}=10^6)$ and $V_{\rho} \sim 1/\mathcal{G}amma(\text{shape}=0.05,\text{rate}=0.0005)$. We run a Markov Chain Monte Carlo (MCMC) of 2000 iterations. We discarded the first 1000 iterations (burn-in phase) and we thinned the chain each 5 iterations (to reduce autocorrelation between samples). We obtained 1000 estimates for each parameter. MCMC convergence was visually checked looking at MCMC traces and parameter posterior distributions. Function `model_binomial_iCAR()` from the `forestatrisk` Python package was used for parameter inference. This function calls an adaptive Metropolis-within-Gibbs algorithm [@Rosenthal2011] written in C for maximum computation speed. 

**Add figure for CAR model (damier).**

**Add figure for the grid over a country, e.g. DRC.**

## Variable selection



## Model comparison

We computed the deviance $\mathcal{D}$ of the two models with the formula $\mathcal{D}=-2 \log \mathcal{L}$, $\mathcal{L}$ being the likelihood of the model, i.e. the probability of observing the data given the model and estimated parameters. We compared the deviance of the two models with the deviances of both the "null" model and the "full" model. The "null" model assumes a constant probability of deforestation for all theobservations and has only one parameter, the intercept of the linear relationship. At the other extreme, the "full" model has as many parameters as there are observations. We then computed the percentage of deviance explained by each model, considering that the "null" model explains 0% of the deviance and the "full" model explains 100% of the deviance.

We also performed a cross-validation to compare models using an independent validation data-set of 20,000 forest pixels in 2000. Again, the sample was stratified between 10,000 deforested pixels in 2000--2010 and 10,000 non-deforested pixels. We used the fitted models to predict the deforestation probability of all the pixels of the validation data-set. To transform the deforestation probabilities into binary values, we identified the probability threshold respecting the percentage of deforested pixels (eg. the mode of the probabilities for a deforestation rate of 50%). Using model predictions and observations, we computed several accuracy indices: the Area Under the ROC Curve (AUC), the Figure of Merit (FOM), the Overall Accuracy (OA), the Expected Accuracy (EA), the Kappa of Cohen (K), the Specificity (Spe), the Sensitivity(Sen), and the True Skill Statistics (TSS). A detailed description of these indices can be found in @Pontius2008 (for the FOM) and @Liu2011 (for all the other indices). Formulas used to compute these indices are presented in Appendix 1.

Because the value of these indices depends on the deforestation rate [@Pontius2008], we computed the accuracy indices for various percentage of deforested pixels: 1, 5, 10, 25 and 50%. To do so, we selected subsamples of the deforested pixels in our validation data-set at random.

## Computing the spatial probability of deforestation in 2010

For the "icar" model, before computing the predictions of the deforestation probability, the spatial random effects at 10 km were interpolated at 1 km using a bicubic interpolation method. This was done in order to obtain spatial random effects at a resolution closer to the original forest raster resolution of 30 m, and to smooth the deforestation probability spatially. 

Deforestation probabilities (float values in the interval $[0, 1]$) were transformed as integer values on the interval $[\![1, 65535]\!]$. This allowed us to record the large raster of probabilities as UInt16 type and save space on disk. We then obtained a map of the relative probability of deforestation for the year 2010 at 30 m resolution.

In 2010, Madagascar was covered by 9.3 Mha of natural forest corresponding to more than 104 M pixels at 30 m resolution. Predictions were computed using functions `predict_raster*()` from the `forestatrisk` Python package which make computation fast and efficient (with low memory usage) by treating raster data by blocks.

## Forecasting forest cover change on the period 2010--2017

We computed the observed deforestation $D$ (in ha) on the period 2010--2017 from the forest cover maps at these two dates. To forecast the forest cover change in 2010--2017 with our models, we used the previously derived maps of relative probability of deforestation in 2010. The resolution of these maps is $r=30$ m, equivalent to $r_{\text{ha}}=0.09$ ha. We computed a probability threshold $\theta_T$ in the interval $[\![1, 65535]\!]$ identifying the $n$ forest pixels in 2010 with the highest probability of deforestation so that $n r_{\text{ha}} = D + \epsilon$. Because deforestation probabilities have finite values in $[\![1, 65535]\!]$, some forest pixels might have the same deforestation probability and it might not be possible to identify $\theta_T$ such that $\epsilon=0$. We thus selected the threshold $\theta_T$ minimizing $\epsilon$. We obtained negligible $\epsilon$ ($<$ 32,000 ha) compared to $D$ (874,211 ha) for both models. We considered those $n$ forest pixels in 2010 as deforested on the period 2010--2017 and derived the forest cover change map on that period.

## Softwares



\newpage
